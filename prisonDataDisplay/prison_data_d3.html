<!DOCTYPE html>
<meta charset="utf-8">
<style>

</style>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript" src="prisonData.js"></script>
<body>
<script>

  var h = 500;
  var w = 800;
  var barPadding = 2;

  var svg = d3.select("body").append("svg")
              .attr("height", h)
              .attr("width", w);

  var parseDate = d3.time.format("%m/%d/%y").parse

  // prison_data.forEach(function(d) {
  //   d.date = parseDate(d.date);
  // });

  var dataByGroup = 
    d3.nest()
      // .key(function (d) { return d.date.getFullYear(); })
      .key(function (d) { return parseDate(d.date).getFullYear(); })
      .rollup(function (v) { return {
        count: v.length,
        avg_age: d3.mean(v, function(d) { return d.age; })
      }; })
      .entries(prison_data);
  console.log(dataByGroup);

  var bars = svg.selectAll("rect")
              .data(dataByGroup)
              .enter()
              .append("rect");

  var points = svg.selectAll("circle")
                .data(dataByGroup)
                .enter()
                .append("circle")

  bars.attr("height", function(d) {return d.values.count * 5 } )
      // .attr("width", 20)
      .attr("width", w / dataByGroup.length - barPadding)
      .attr("y", function (d){ return (h/2) - (d.values.count * 5)})
      .attr("x", function (d,i){
        // return (i * 30)
        return (i * (w / dataByGroup.length)) })
      .attr("fill", "red")
      // .attr("fill", function (d) {
      //   return "rgb(0, 0, " + (d.values.count * 10) + ")"; });

  points.attr("cx", function (d,i) { 
        console.log(i, d.values.avg_age)
        return (i * (w / dataByGroup.length)) + ((w / dataByGroup.length - barPadding) / 2) })
      .attr("cy", function (d) { return d.values.avg_age })
      // .attr("cy", function (d){ return (h/2) - (d.values.count * 5)})
      .attr("r", 5)
      // .attr("fill", "white")



</script>
</body>
